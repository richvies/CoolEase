/**
 ******************************************************************************
 * @file    bootloader_utils.c
 * @author  Richard Davies
 * @date    25/Dec/2020
 * @brief   Bootloader_utils Source File
 *  
 ******************************************************************************
 */

////////////////////////////////////////////////////////////////////////////////
// Includes
////////////////////////////////////////////////////////////////////////////////

#include <libopencm3/cm3/common.h>

/** @addtogroup BOOTLOADER_UTILS_FILE 
 * @{
 */

/** @addtogroup BOOTLOADER_UTILS_INT 
 * @{
 */

////////////////////////////////////////////////////////////////////////////////
// Static Variables
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Static Function Declarations
////////////////////////////////////////////////////////////////////////////////

/** @} */

/** @addtogroup BOOTLOADER_UTILS_API
 * @{
 */

////////////////////////////////////////////////////////////////////////////////
// Exported Function Definitions
////////////////////////////////////////////////////////////////////////////////
void boot_deinit()
{

}

// typedef void (*EntryPoint)(void);

void boot_jump(uint32_t address)
{
  uint32_t application_address = MMIO32(address + 4);
  EntryPoint application = (EntryPoint)(application_address);
  __set_MSP(*(__IO uint32_t*)address);
  application();
}

/** @} */

/** @addtogroup BOOTLOADER_UTILS_INT
 * @{
 */

////////////////////////////////////////////////////////////////////////////////
// Static Function Definitions
////////////////////////////////////////////////////////////////////////////////

/** @} */
/** @} */