{
    "version": "2.0.0",
    "tasks": [
        //////////////////////////////
        // Builds
        //////////////////////////////
        // Build all
        {
            "label": "Build all",
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "dependsOn":["Build hub", "Build sensor"],
            "presentation": {
                "focus": true
            },
            "problemMatcher":[]
        },   
        // Rebuild all
        {
            "label": "Rebuild all",
            "group": "build",
            "dependsOrder": "sequence",
            "dependsOn":["Clean all", "Build all"],
            "presentation": {
                "focus": true
            },
            "problemMatcher":[]
        },  
        // Rebuild Hub
        {
            "label": "Rebuild hub",
            "group": "build",
            "dependsOrder": "sequence",
            "dependsOn":["Clean hub", "Build hub"],
            "presentation": {
                "focus": true
            },
            "problemMatcher":[]
        },
        // Rebuild Sensor
        {
            "label": "Rebuild sensor",
            "group": "build",
            "dependsOrder": "sequence",
            "dependsOn":["Clean sensor", "Build sensor"],
            "presentation": {
                "focus": true
            },
            "problemMatcher":[]
        },
        // Build hub
        {
            "label": "Build hub",
            "group": "build",
            "type": "shell",
            "command": "make -fhub/Makefile all",
            "args": [],
            "problemMatcher": {
                "pattern": {
                    "regexp": "^(.*):(\\d+):(\\d+):\\s+(warning|error):\\s+(.*)$",
                    "file": 1,
                    "line": 2,
                    "column": 3,
                    "severity": 4,
                    "message": 5
                }
            },
            "presentation": {
                "focus": true
            }
        },
        // Build sensor
        {
            "label": "Build sensor",
            "group": "build",
            "type": "shell",
            "command": "make -fsensor/Makefile all",
            "problemMatcher": {
                "pattern": {
                    "regexp": "^(.*):(\\d+):(\\d+):\\s+(warning|error):\\s+(.*)$",
                    "file": 1,
                    "line": 2,
                    "column": 3,
                    "severity": 4,
                    "message": 5
                }
            },
            "presentation": {
                "focus": true
            }
        },
        // Clean all
        {
            "label": "Clean all",
            "group": "build",
            "dependsOn":["Clean hub", "Clean sensor"],
            "presentation": {
                "focus": true
            },
            "problemMatcher":[]
        },
        // Clean hub
        {
            "label": "Clean hub",
            "group": "build",
            "type": "shell",
            "command": "make -fhub/Makefile clean",
            "args": [],
            "problemMatcher": {
                "pattern": {
                    "regexp": "^(.*):(\\d+):(\\d+):\\s+(warning|error):\\s+(.*)$",
                    "file": 1,
                    "line": 2,
                    "column": 3,
                    "severity": 4,
                    "message": 5
                }
            },
            "presentation": {
                "focus": true
            }
        },
        // Clean sensor
        {
            "label": "Clean sensor",
            "group": "build",
            "type": "shell",
            "command": "make -fsensor/Makefile clean",
            "problemMatcher": {
                "pattern": {
                    "regexp": "^(.*):(\\d+):(\\d+):\\s+(warning|error):\\s+(.*)$",
                    "file": 1,
                    "line": 2,
                    "column": 3,
                    "severity": 4,
                    "message": 5
                }
            },
            "presentation": {
                "focus": true
            }
        },
        
        //////////////////////////////
        // Download
        //////////////////////////////
        // Hub
        {
            "label": "Hub Download",
            "type": "shell",
            "command": "/usr/local/bin/openocd",
            "args": [
                "-f",
                "tools/openocd/stlink.cfg",
                "-f",
                "tools/openocd/stm32l0.cfg",
                "-c",
                "program hub/bin/hub.elf verify",
                "-c",
                "reset",
                "-c",
                "exit"
            ],
            "dependsOn": ["Build hub"],
            "problemMatcher": []
        },
        // Hub Bootloader
        {
            "label": "Hub Bootloader Download",
            "type": "shell",
            "command": "/usr/local/bin/openocd",
            "args": [
                "-f",
                "tools/openocd/stlink.cfg",
                "-f",
                "tools/openocd/stm32l0.cfg",
                "-c",
                "program hub/bin/hub_bootloader.elf verify",
                "-c",
                "reset",
                "-c",
                "exit"
            ],
            "dependsOn": ["Build hub"],
            "problemMatcher": []
        },
        // Sensor
        {
            "label": "Sensor Download",
            "type": "shell",
            "command": "./tools/stm32flash/stm32flash",
            "args": [
                "-b230400",
                "-E",
                "-S0x08004000",
                "-wsensor/bin/sensor.bin",
                "-v",
                "-R",
                "-i-dtr,rts,-rts:rts",
                "/dev/cu.usbserial-A50285BI",
            ],
            "dependsOn": ["Build sensor"],
            "problemMatcher": []
        },
        // Sensor Bootloader
        {
            "label": "Sensor Bootloader Download",
            "type": "shell",
            "command": "./tools/stm32flash/stm32flash",
            "args": [
                "-b230400",
                "-E",
                "-S0x08000000",
                "-wsensor/bin/sensor_bootloader.bin",
                "-v",
                "-R",
                "-i-dtr,rts,-rts:rts",
                "/dev/cu.usbserial-A50285BI",
            ],
            "dependsOn": ["Build sensor"],
            "problemMatcher": []
        },
        // Sensor EEPROM
        {
            "label": "Sensor EEPROM Download",
            "type": "shell",
            "command": "./tools/stm32flash/stm32flash",
            "args": [
                "-b230400",
                "-E",
                "-S0x08080000",
                "-wsensor/sensor_eeprom.bin",
                "-v",
                "-R",
                "-i-dtr,rts,-rts:rts",
                "/dev/cu.usbserial-A50285BI",
            ],
            // "dependsOn": ["Build sensor"],
            "problemMatcher": []
        },
        // CPU: Reset & run
        {
            "label": "CPU: Reset and run",
            "type": "shell",
            "command": "/usr/local/bin/openocd",
            "args": [
                "-f",
                "tools/openocd/stlink.cfg",
                "-f",
                "tools/openocd/stm32l0.cfg",
                "-c init",
                "-c reset",
                "-c exit"
            ],
            "problemMatcher": []
        },
        // CPU: Halt
        {
            "label": "CPU: Halt",
            "type": "shell",
            "command": "/usr/local/bin/openocd",
            "args": [
                "-f",
                "tools/openocd/stlink.cfg",
                "-f",
                "tools/openocd/stm32l0.cfg",
                "-c init",
                "-c halt",
                "-c exit"
            ],
            "problemMatcher": []
        },
        // CPU: Resume
        {
            "label": "CPU: Resume",
            "type": "shell",
            "command": "/usr/local/bin/openocd",
            "args": [
                "-f",
                "tools/openocd/stlink.cfg",
                "-f",
                "tools/openocd/stm32l0.cfg",
                "-c init",
                "-c resume",
                "-c exit"
            ],
            "problemMatcher": []
        },
        
        //////////////////////////////
        // Python
        //////////////////////////////
        // Run python file
        {
            "label": "Run Python file",
            "type": "shell",
            "command": "python",
            "args": [
                "${file}"
            ],
            "presentation": {
                "focus": true
            },
            "problemMatcher": []
        },
        
        
        //////////////////////////////
        // CubeMX
        //////////////////////////////
        // Open .ioc
        {
            "label": "Open CubeMX project",
            "type": "shell",
            "command": "/Applications/STMicroelectronics/STM32CubeMX.app/Contents/MacOs/STM32CubeMX",
            "args": [
                "CubeMXTest.ioc"
            ],
            "presentation": {
                "focus": false
            },
            "problemMatcher": []
        },
        
        //////////////////////////////
        // Doxygen
        //////////////////////////////
        // Generate
        {
            "label": "Generate Doxygen",
            "type": "shell",
            "command": "doxygen Docs/doxygen/Doxyfile",
            "presentation": {
                "focus": true
            },
            "problemMatcher": []
        },
        // Open
        {
            "label": "Open Doxygen",
            "type": "shell",
            "command": "open docs/doxygen/html/index.html",
            "presentation": {
                "focus": true
            },
            "problemMatcher": [],
            "dependsOn": "Generate Doxygen"
        }
    ]
}