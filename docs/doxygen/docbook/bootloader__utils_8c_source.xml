<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="_bootloader__utils_8c_source" xml:lang="en-US">
<title>bootloader_utils.c</title>
<indexterm><primary>common/src/bootloader_utils.c</primary></indexterm>
<programlisting>00001 
00011 <emphasis role="comment">/*////////////////////////////////////////////////////////////////////////////*/</emphasis>
00012 <emphasis role="comment">//&#32;Includes</emphasis>
00013 <emphasis role="comment">/*////////////////////////////////////////////////////////////////////////////*/</emphasis>
00014 
00015 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_bootloader__utils_8h">common/bootloader_utils.h</link>&quot;</emphasis>
00016 
00017 <emphasis role="preprocessor">#include&#32;&lt;libopencm3/cm3/cortex.h&gt;</emphasis>
00018 <emphasis role="preprocessor">#include&#32;&lt;libopencm3/cm3/scb.h&gt;</emphasis>
00019 <emphasis role="preprocessor">#include&#32;&lt;libopencm3/cm3/common.h&gt;</emphasis>
00020 
00029 <emphasis role="comment">/*////////////////////////////////////////////////////////////////////////////*/</emphasis>
00030 <emphasis role="comment">//&#32;Static&#32;Variables</emphasis>
00031 <emphasis role="comment">/*////////////////////////////////////////////////////////////////////////////*/</emphasis>
00032 
00033 <emphasis role="comment">/*////////////////////////////////////////////////////////////////////////////*/</emphasis>
00034 <emphasis role="comment">//&#32;Static&#32;Function&#32;Declarations</emphasis>
00035 <emphasis role="comment">/*////////////////////////////////////////////////////////////////////////////*/</emphasis>
00036 
00043 <emphasis role="comment">/*////////////////////////////////////////////////////////////////////////////*/</emphasis>
00044 <emphasis role="comment">//&#32;Exported&#32;Function&#32;Definitions</emphasis>
00045 <emphasis role="comment">/*////////////////////////////////////////////////////////////////////////////*/</emphasis>
<anchor xml:id="_bootloader__utils_8c_source_1l00046"/><link linkend="_group___b_o_o_t_l_o_a_d_e_r___u_t_i_l_s___a_p_i_1ga6252b1935a7b8e2e6c14a969372929a2">00046</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_group___b_o_o_t_l_o_a_d_e_r___u_t_i_l_s___a_p_i_1ga6252b1935a7b8e2e6c14a969372929a2">boot_deinit</link>(<emphasis role="keywordtype">void</emphasis>)
00047 {
00048 
00049 }
00050 
<anchor xml:id="_bootloader__utils_8c_source_1l00051"/><link linkend="_group___b_o_o_t_l_o_a_d_e_r___u_t_i_l_s___a_p_i_1gae9e4d81efbd526a6c67fd8f1f104d5b3">00051</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_group___b_o_o_t_l_o_a_d_e_r___u_t_i_l_s___a_p_i_1gae9e4d81efbd526a6c67fd8f1f104d5b3">boot_jump_to_application</link>(uint32_t&#32;address)
00052 {
00053 &#32;&#32;<emphasis role="comment">//&#32;Disable&#32;Interrupts</emphasis>
00054 &#32;&#32;__asm__&#32;<emphasis role="keyword">volatile</emphasis>&#32;(<emphasis role="stringliteral">&quot;CPSID&#32;I\n&quot;</emphasis>);
00055 
00056 &#32;&#32;<emphasis role="comment">//&#32;Update&#32;vector&#32;table&#32;offset</emphasis>
00057 &#32;&#32;SCB_VTOR&#32;=&#32;address;
00058 
00059 &#32;&#32;<emphasis role="comment">//&#32;Update&#32;main&#32;stack&#32;pointer</emphasis>
00060 &#32;&#32;__asm__(<emphasis role="stringliteral">&quot;msr&#32;msp,&#32;%0&quot;</emphasis>&#32;:&#32;:&#32;<emphasis role="stringliteral">&quot;r&quot;</emphasis>&#32;(MMIO32(address)));
00061 
00062 &#32;&#32;<emphasis role="comment">//&#32;Get&#32;start&#32;address&#32;of&#32;program</emphasis>
00063 &#32;&#32;void&#32;(*start)(void)&#32;=&#32;(<emphasis role="keywordtype">void</emphasis>*)MMIO32(address&#32;+&#32;4);
00064 
00065 &#32;&#32;<emphasis role="comment">//&#32;Enable&#32;interrupts</emphasis>
00066 &#32;&#32;__asm__&#32;<emphasis role="keyword">volatile</emphasis>&#32;(<emphasis role="stringliteral">&quot;CPSIE&#32;I\n&quot;</emphasis>);
00067 
00068 &#32;&#32;start();
00069 
00070 &#32;&#32;<emphasis role="keywordflow">while</emphasis>(1){&#32;};
00071 }
00072 
00079 <emphasis role="comment">/*////////////////////////////////////////////////////////////////////////////*/</emphasis>
00080 <emphasis role="comment">//&#32;Static&#32;Function&#32;Definitions</emphasis>
00081 <emphasis role="comment">/*////////////////////////////////////////////////////////////////////////////*/</emphasis>
00082 
</programlisting></section>
